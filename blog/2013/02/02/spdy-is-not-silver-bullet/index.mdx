---
authors: [ykzts]
date: 2013-02-03T02:18:00+09:00
redirect_from: /post/42110686577
tags: [tech]
title: SPDYはどのような状況でも速度向上が見込めるような万能な技術ではない
---

ここ最近、俄かにSPDYが流行の兆しを見せているように見える。言及されぬ技術は使われず、そして使われぬ技術は存在しない物であるのと同義であると私は考えるので悪い事ではないのだが、本来SPDYを使う上で注意すべきである点を無視して言及しているように見えるので一度深く熟考する必要があるのではないだろうか。

<!--truncate-->

SPDYは複数の要求を一つの接続に纏め上げられる通信規格であり、通常のHTTPによる通信に於いて存在していた大きな速度遅延の要因をなくす事は、確かに出来ている。だがSPDYは規格の仕様上、TLSを上層に配す、HTTPSである事を求められている。HTTPSは暗号化と複合化の処理だけではなく、証明書の確認も行われる事になる為に、HTTPよりも速度は低下する事になってしまっている。数十程度の接続しかなされないようなウェブページであれば、SPDYを使う事によって得られる速度向上よりも、HTTPSを使う事による速度低下の方が大きくなり、結果として速度が低下してしまう事になる。SPDYによる恩恵が得られるのは、画像が数百枚も貼付されているウェブページや、Ajaxによる動的な情報取得を繰り返し短時間の内に幾つもの通信が常に発生し続けるようなウェブアプリケーションに限られると私は考える。文書が主体となり、画像が数枚しかないようなウェブページでは全く意味のないどころか、逆に悪影響を与える結果にしかならないのではないか。

また、同一のホスト名による通信でなければ、SPDYによる速度向上の恩恵には与れない。厳密に言えば、同一の証明書に於いてエイリアスの指定を行ったり、コモンネームにワイルドカードを使用したりする事により、複数ホスト名を使う事が出来る。だが、ホスト名が限定されてしまう事には変わりない。例えば、Amazon S3といったストレージサービスを使い、画像ファイル等の配信を行っている場合に、SPDYは全く効果を発揮しない。またAmazon S3では任意のホスト名を指定する事が出来るが、現時点ではホスト名が s3.amazonaws.com や *.s3.amazonaws.com となっていない場合にはHTTPのみになってしまっている。Amazon側に証明書を渡す事によりこうした問題が発生しなくなる可能性はあるのだろうが、現時点では問題しかない。

そして、SPDYはHTTPSでの通信となっている事が必須である都合上、今までHTTPで提供されていた場合にはURIが変わってしまう。301 Moved PermanentlyとLocationヘッダーを用いた転送を行う事により、既存のURIから誘導する事は可能であるが、[クールなURIは変わらない](http://www.kanzaki.com/docs/Style/URI)というウェブの基本的な考えが通用しなくなってしまう。かてて加えて、もしいつかSPDYを使うのを止めようと考えた時にも、今度はHTTPSを常に維持し続けなければならなくなる。HTTPの維持はそう面倒な事ではないが、HTTPSの維持は証明書の絡みもあり、多少とはいえ煩わしさがある。今後の事を考えれば、必ずしも必要であると断定出来ない場合には避けるべきであろう。

現在多く使われているウェブサーバーはApacheとnginxの二つだろう。Apacheにはモジュールが存在しており、またnginxには開発版に任意のパッチを適用した上でビルドする事により、いづれの場合にも簡単にSPDY対応を施す事が出来る。その為に他の速度向上の方法を試す前に気軽にSPDYを使おうと考える者もいるであろう。だが、SPDYによって速度が向上する場合は非常に限定的である。きちんと自身の提供する物がどういった物であるのかを考え、SPDYが適切でない場合には、適切な他の手段を使用するべきである。

例えばWordPressを使用している場合はPHP自身の速度の遅さやMySQLを用いた情報の授受によって生じる速度低下の方が通信によるボトルネックよりも致命的であると考えられる。APCの導入やmemcached等を使った適切なキャッシュを行う方が速度向上には有効だろう。またJavaScriptによる動的な操作を多様するようなウェブページであればDOM操作を適切に行う事により、処理が遅くなってしまう事が避けられ、閲覧者の体感する速度向上は非常に大きくなる。現在のJavaScriptは多くの実装がJITにより高速に動作するようになったが、DOM操作は非常に遅いままである。適切な記述をしなければ、その積み重ねにより無視出来ない致命的な速度遅延を招く。SPDYを使うよりも有効で、そして現実的な方法が幾つも存在している。

とはいえ、機密性の高い情報のやり取りを行う必要があり、元よりHTTPで提供する事が考えられず、HTTPSにする必要がある場合にはSPDYを使っても損はない。SPDYに限らず、こうした最新の技術は深く考えた上で適材適所に合致するような適切な選択をそのつどに行っていくのが肝要である。
